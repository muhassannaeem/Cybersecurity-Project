apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: cybersecurity-ingress
  namespace: cybersecurity-platform
  annotations:
    kubernetes.io/ingress.class: "nginx"
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    # WebSocket support for Socket.IO
    nginx.ingress.kubernetes.io/upstream-hash-by: "$remote_addr"
    nginx.ingress.kubernetes.io/configuration-snippet: |
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
spec:
  rules:
  - host: cybersecurity.local
    http:
      paths:
      # Frontend
      - path: /
        pathType: Prefix
        backend:
          service:
            name: frontend
            port:
              number: 3000
      
      # Backend API
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: backend
            port:
              number: 5000
      
      # Socket.IO endpoints
      - path: /socket.io
        pathType: Prefix
        backend:
          service:
            name: backend
            port:
              number: 5000
      
      # Kibana
      - path: /kibana
        pathType: Prefix
        backend:
          service:
            name: kibana
            port:
              number: 5601
      
      # Direct access to microservices (for development/debugging)
      - path: /behavioral-analysis
        pathType: Prefix
        backend:
          service:
            name: behavioral-analysis
            port:
              number: 5001
      
      - path: /decoy-generator
        pathType: Prefix
        backend:
          service:
            name: decoy-generator
            port:
              number: 5002
      
      - path: /traffic-monitor
        pathType: Prefix
        backend:
          service:
            name: traffic-monitor
            port:
              number: 5003
      
      - path: /threat-attribution
        pathType: Prefix
        backend:
          service:
            name: threat-attribution
            port:
              number: 5004
      
      - path: /visualization-dashboard
        pathType: Prefix
        backend:
          service:
            name: visualization-dashboard
            port:
              number: 5005
      
      - path: /threat-intelligence
        pathType: Prefix
        backend:
          service:
            name: threat-intelligence
            port:
              number: 5006
      
      - path: /adaptive-deception
        pathType: Prefix
        backend:
          service:
            name: adaptive-deception
            port:
              number: 5007
      
      - path: /evaluation-engine
        pathType: Prefix
        backend:
          service:
            name: evaluation-engine
            port:
              number: 5008